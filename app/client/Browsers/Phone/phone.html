<html>
    <meta charset="utf-8">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
      <script src="../vue.js"></script>
      <script src="../moment.js"></script>
	<body>
		<div id="app">
            <div class="phone" style="background: url('images/wallpaper.png'); background-size: 100% 100%;">
                <img src="images/iphone-x.png">

                <div class="phone-messages animated zoomIn faster" v-if="currentTab === 1">
                    <div class="head">
                        <h1>Messages</h1>
                        <i class="fa fa-comment"></i>
                    </div>  
                    <ul>
                        <li v-for="(talk, i) in d.talks" :class="[{ active: currentLi === i }]">
                            <div class="avatar">CM</div>
                            <h3 v-if="phone == talk.sender">{{ talk.receiver }}</h3>
                            <h3 v-else>{{ talk.sender }}</h3>
                            <span class="time">{{ talk.time | format }}</span>
                            <i class="fa fa-chevron-right"></i>
                            <p>{{ talk.text }}</p>
                        </li>
                    </ul>
                </div>

                <div class="phone-conversation" v-if="currentTab === 10">
                    <div class="head">
                        <i class="fa fa-chevron-left"></i>
                        <h1>Nitram Domenia</h1>
                    </div>
                    <div id="chat" class="chat">
                        <div v-for="(msg, j) in d.messages" class="messages" :class="{ 'mine' : msg.sender == phone, 'yours' : msg.sender != phone}">
                            <div class="message last">
                                {{ msg.text }}
                            </div>
                        </div>
                        <br><br><br><br>
                    </div>
                    <div class="reply" id="reply-div">
                        <textarea id="reply" rows="3" @keyup="autoGrow"></textarea>
                        <button class="send" type="button"><i class="fa fa-arrow-up"></i></button>
                    </div>
                </div>

                <div class="phone-calls animated zoomIn faster" v-if="currentTab === 2">
                    
                </div>

                
                
                <div class="phone-footer" v-if="currentTab === 0">
                    <a class="call" @click="currentTab = 2"></a>
                    <a class="sms" @click="currentTab = 1"></a>
                </div>
            </div>
		</div>
	</body>
</html>



<script>

moment.locale('fr', {
    months : 'janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre'.split('_'),
    monthsShort : 'janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.'.split('_'),
    monthsParseExact : true,
    weekdays : 'dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi'.split('_'),
    weekdaysShort : 'dim._lun._mar._mer._jeu._ven._sam.'.split('_'),
    weekdaysMin : 'Di_Lu_Ma_Me_Je_Ve_Sa'.split('_'),
    weekdaysParseExact : true,
    longDateFormat : {
        LT : 'HH:mm',
        LTS : 'HH:mm:ss',
        L : 'DD/MM/YYYY',
        LL : 'D MMMM YYYY',
        LLL : 'D MMMM YYYY HH:mm',
        LLLL : 'dddd D MMMM YYYY HH:mm'
    },
    calendar : {
        sameDay : '[Aujourd’hui à] LT',
        nextDay : '[Demain à] LT',
        nextWeek : 'dddd [à] LT',
        lastDay : '[Hier à] LT',
        lastWeek : 'dddd [dernier à] LT',
        sameElse : 'L'
    },
    relativeTime : {
        future : 'dans %s',
        past : 'il y a %s',
        s : 'quelques secondes',
        m : 'une minute',
        mm : '%d minutes',
        h : 'une heure',
        hh : '%d heures',
        d : 'un jour',
        dd : '%d jours',
        M : 'un mois',
        MM : '%d mois',
        y : 'un an',
        yy : '%d ans'
    },
    dayOfMonthOrdinalParse : /\d{1,2}(er|e)/,
    ordinal : function (number) {
        return number + (number === 1 ? 'er' : 'e');
    },
    meridiemParse : /PD|MD/,
    isPM : function (input) {
        return input.charAt(0) === 'M';
    },
    // In case the meridiem units are not separated around 12, then implement
    // this function (look at locale/id.js for an example).
    // meridiemHour : function (hour, meridiem) {
    //     return /* 0-23 hour, given meridiem token and hour 1-12 */ ;
    // },
    meridiem : function (hours, minutes, isLower) {
        return hours < 12 ? 'PD' : 'MD';
    },
    week : {
        dow : 1, // Monday is the first day of the week.
        doy : 4  // Used to determine first week of the year.
    }
});

const app = new Vue({
	el: '#app',
	data: {
        currentTab: 0,
        currentLi: 0,
        phone: 0,
		d: {
            messages: [
                
            ],
            talks: [

            ]
            // messages: [
            //     {"id":1,"sender":555555,"receiver":123456,"text":"wesh pd ça va ?","time":"2019-08-05T14:38:36.000Z"},{"id":2,"sender":555555,"receiver":123456,"text":"salope t'es ou ?","time":"2019-08-05T14:38:48.000Z"}
            // ],
		},
    },
    created() {
        window.addEventListener('keydown', (e) => {
            if(e.key == 'Backspace') {
                var reply = document.getElementById("reply");

                if(document.activeElement === reply)
                    return;

                if(this.currentTab == 0)
                    mp.trigger("cCloseCef"); 
                if(this.currentTab == 1)
                    this.currentTab = 0;
                if(this.currentTab == 10)
                    this.currentTab = 1;
            }
            if(e.key == 'ArrowDown') {
                if(this.currentTab == 1)
                {
                    this.currentLi++;
                }
                if(this.currentTab == 10)
                    this.scrollToBottom("chat");
                    
            }
            if(e.key == 'ArrowUp') {
                if(this.currentTab == 1)
                {
                    this.currentLi--;
                    if(this.currentLi <= 0)
                        this.currentLi = 0;
                }
                if(this.currentTab == 10)
                    this.scrollToTop("chat");
                    
            }
            if(e.key == 'Enter') {
                if(this.currentTab == 1)
                {
                    this.currentTab = 10;
                }
                if(this.currentTab == 10) 
                {
                    var element = document.getElementById("reply");
                    element.focus();
                }
            }
        });
    }, 
	computed: {
		currentTabComponent: function () {
			return 'tab' + this.currentTab;
		},
	},
	methods: {
        autoGrow: function() {
            var element = document.getElementById("reply");
            var element2 = document.getElementById("reply-div");
            if(element.clientHeight < element.scrollHeight)
            {
                element.style.height = element.scrollHeight + "px";
                if(element.clientHeight < element.scrollHeight)
                {
                    element.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                }
                else 
                {
                    element.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                }
            }
        },
        scrollToBottom: function(id) {
            var element = document.getElementById(id);
            element.scrollTop += 20;
        },
        scrollToTop: function(id) {
            var element = document.getElementById(id);
            element.scrollTop -= 20;
        },
		exit: function() {
			mp.trigger("cCloseCef"); 
        },
    },
    filters: {
		format(date) {
            var now = moment();

            if(moment(date).diff(now, 'days') <= 0)
                return moment(date).format('LT');
            else if(moment(date).diff(now, 'days') <= 1)
                return moment(date).format('Hier');
            else if(moment(date).diff(now, 'days') <= 7)
                return moment(date).format('ddd');
            else if(moment(date).diff(now, 'days') >= 7)
                return moment(date).format('D/MM/YYYY');
		},
		fromNow(date) {
			return moment(date).fromNow();
		}
	},
});
</script>