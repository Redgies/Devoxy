<html>
    <meta charset="utf-8">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
      <script src="../vue.js"></script>
      <script src="../moment.js"></script>
	<body>
		<div id="app">
            <div class="phone" style="background: url('images/wallpaper.png'); background-size: 100% 100%;">
                <img src="images/iphone-x.png">

                <div class="phone-messages animated zoomIn faster" v-if="currentTab === 1">
                    <div class="head">
                        <h1>Messages</h1>
                        <i class="fa fa-comment"></i>
                    </div>  
                    <ul>
                        <li v-for="(talk, i) in d.talks" :class="[{ active: currentLi === i }]">
                            <div class="avatar">NA</div>
                            <h3 v-if="phone == talk.sender">{{ talk.receiver }}</h3>
                            <h3 v-else>{{ talk.sender }}</h3>
                            <span class="time">{{ talk.time | format }}</span>
                            <i class="fa fa-chevron-right"></i>
                            <p>{{ talk.text }}</p>
                        </li>
                    </ul>
                </div>

                <div class="phone-conversation" v-if="currentTab === 10">
                    <div class="head">
                        <i class="fa fa-chevron-left"></i>
                        <h1 v-if="phone == talk.sender">{{ talk.receiver }}</h1>
                        <h1 v-else>{{ talk.sender }}</h1>
                    </div>
                    <div id="chat" class="chat">
                        <div v-for="(msg, j) in d.messages" class="messages" :class="{ 'mine' : msg.sender == phone, 'yours' : msg.sender != phone}">
                            <div class="message last">
                                {{ msg.text }}
                            </div>
                        </div>
                        <br><br><br><br>
                    </div>
                    <div class="reply" id="reply-div">
                        <textarea id="reply" rows="3" @keyup="autoGrow"></textarea>
                        <button class="send" type="button"><i class="fa fa-arrow-up"></i></button>
                    </div>
                </div>

                <div class="phone-calls animated zoomIn faster" v-if="currentTab === 2">
                    
                </div>

                
                
                <div class="phone-footer" v-if="currentTab === 0">
                    <a class="call" @click="currentTab = 2"></a>
                    <a class="sms" @click="currentTab = 1"></a>
                </div>
            </div>
		</div>
	</body>
</html>



<script>
moment.locale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e){return e+(1===e?"er":"e")},meridiemParse:/PD|MD/,isPM:function(e){return"M"===e.charAt(0)},meridiem:function(e,a,r){return e<12?"PD":"MD"},week:{dow:1,doy:4}});

const app = new Vue({
	el: '#app',
	data: {
        currentTab: 0,
        currentLi: 0,
        phone: 0,
		d: {
            messages: [
                
            ],
            talks: [

            ]
		},
    },
    created() {
        window.addEventListener('keydown', (e) => {
            if(e.key == 'Backspace') {
                var reply = document.getElementById("reply");

                if(document.activeElement === reply)
                    return;

                if(this.currentTab == 0)
                    mp.trigger("cCloseCef"); 
                if(this.currentTab == 1)
                    this.currentTab = 0;
                if(this.currentTab == 10)
                    this.currentTab = 1;
            }
            if(e.key == 'ArrowDown') {
                if(this.currentTab == 1)
                {
                    this.currentLi++;
                }
                if(this.currentTab == 10)
                    this.scrollToBottom("chat");
                    
            }
            if(e.key == 'ArrowUp') {
                if(this.currentTab == 1)
                {
                    this.currentLi--;
                    if(this.currentLi <= 0)
                        this.currentLi = 0;
                }
                if(this.currentTab == 10)
                    this.scrollToTop("chat");
                    
            }
            if(e.key == 'Enter') {
                if(this.currentTab == 1)
                {
                    this.currentTab = 10;
                }
                if(this.currentTab == 10) 
                {
                    var element = document.getElementById("reply");
                    element.focus();
                }
            }
        });
    }, 
	computed: {
		currentTabComponent: function () {
			return 'tab' + this.currentTab;
		},
	},
	methods: {
        autoGrow: function() {
            var element = document.getElementById("reply");
            var element2 = document.getElementById("reply-div");
            if(element.clientHeight < element.scrollHeight)
            {
                element.style.height = element.scrollHeight + "px";
                if(element.clientHeight < element.scrollHeight)
                {
                    element.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                }
                else 
                {
                    element.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                }
            }
        },
        scrollToBottom: function(id) {
            var element = document.getElementById(id);
            element.scrollTop += 20;
        },
        scrollToTop: function(id) {
            var element = document.getElementById(id);
            element.scrollTop -= 20;
        },
		exit: function() {
			mp.trigger("cCloseCef"); 
        },
    },
    filters: {
		format(date) {
            var now = moment();

            if(moment(date).diff(now, 'days') <= 0)
                return moment(date).format('LT');
            else if(moment(date).diff(now, 'days') <= 1)
                return moment(date).format('Hier');
            else if(moment(date).diff(now, 'days') <= 7)
                return moment(date).format('ddd');
            else if(moment(date).diff(now, 'days') >= 7)
                return moment(date).format('D/MM/YYYY');
		},
	},
});
</script>