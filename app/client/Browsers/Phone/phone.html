<html>
<meta charset="utf-8">

<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/animate.css">
<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<script src="../vue.js"></script>
<script src="../moment.js"></script>

<script src="js/autosize.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js" type="text/javascript"></script>

<body>
    <div id="app">
        <div class="phone" style="background: url('images/wallpaper.jpg'); background-size: 100% 100%;">
            <img src="images/iphone-x.png">

            <div class="phone-call" v-if="currentTab === 41">
                <h1 id="callContact">{{ callNumber }}</h1>
                <span id="callStatut">{{ callStatut }}</span>

                <img id="declineCall" src="images/decline.png">
            </div>
            <div class="phone-call" v-if="currentTab === 42">
                <h1 id="callContact">{{ callNumber }}</h1>
                <span id="callStatut">{{ callStatut }}</span>
            </div>

            <div class="phone-messages animated zoomIn faster" v-if="currentTab === 40">
                <div class="head">
                    <h1>Appels</h1>
                    <i type="button" class="fa fa-phone"></i>
                </div>
                <input type="text" v-model="callNumber" style="background: rgb(241, 241, 241);height: 27px;outline: none;color: rgb(9, 132, 227);border: none;width: 100%;text-align: center;font-size: 19px;height: 40px;">
                <ul class="contacts">
                    <li v-for="contact, i) in d.contacts" :class="[{ active: currentLi === i }]">
                        {{ contact.firstName}} <b>{{ contact.lastName }}</b>
                    </li>
                </ul>
            </div>

            <div class="phone-messages animated zoomIn faster" v-if="currentTab === 3">
                <div class="head">
                    <h1>Messages</h1>
                    <i class="fa fa-comment"></i>
                </div>
                <ul>
                    <li v-for="(talk, i) in d.talks" :class="[{ active: currentLi === i }]">
                        <div class="avatar">{{ talk.firstName | firstLetter }}{{ talk.lastName | secondLetter }}</div>
                        <h3>{{ talk.firstName }} {{ talk.lastName | anonyme }}</h3>
                        <span class="time">{{ talk.time | format }}</span>
                        <i class="fa fa-chevron-right"></i>
                        <p>{{ talk.text }}</p>
                    </li>
                </ul>
            </div>

            <div class="phone-conversation" v-if="currentTab === 34">
                <div class="head" style="height: 100px;">
                    <i class="fa fa-chevron-left"></i>
                    <div class="avatar"
                        style="position: absolute; width: 50px; left: calc(50% - 31px); transform: translateX(-50%); height: 50px; font-size: 19px; line-height: 50px; margin-top: 15px;">{{ contactFirstName | firstLetter }}{{ contactLastName | firstLetter }}</div>
                    <h1
                        style="width: 100%; text-align: center; text-indent: 0px; margin-left: -16px; margin-top: 70px; font-size: 18px;">
                        {{ contactFirstName }} <b>{{ contactLastName }}</b></h1>
                </div>
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Numéro</span>
                <input type="text" id="contactPhone" v-model="contactPhone"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">
                <br><br><br>
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Prénom</span>
                <input type="text" id="contactFirstName" v-model="contactFirstName"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Nom</span>
                <input type="text" id="contactLastName" v-model="contactLastName"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">

                <button type="button" id="confirmUpdateContact" class="btn-confirm">Valider</button>
            </div>

            <div class="phone-conversation" v-if="currentTab === 35">
                <div class="head" style="height: 100px;">
                    <i class="fa fa-chevron-left"></i>
                    <div class="avatar"
                        style="position: absolute; width: 50px; left: calc(50% - 31px); transform: translateX(-50%); height: 50px; font-size: 19px; line-height: 50px; margin-top: 15px;">{{ contactFirstName | firstLetter }}{{ contactLastName | firstLetter }}</div>
                    <h1
                        style="width: 100%; text-align: center; text-indent: 0px; margin-left: -16px; margin-top: 70px; font-size: 18px;">
                        {{ contactFirstName }} <b>{{ contactLastName }}</b></h1>
                </div>
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Numéro</span>
                <input type="text" id="contactPhone" v-model="contactPhone"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">
                <br><br><br>
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Prénom</span>
                <input type="text" id="contactFirstName" v-model="contactFirstName"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">
                <span class="sms-to"
                    style="position: initial; color: #000; font-size: 13px; margin-top: 3px; margin-left: 24px;">Nom</span>
                <input type="text" id="contactLastName" v-model="contactLastName"
                    style="background: none; font-size: 14px; height: 27px; outline: none; text-indent: 24px; color: #0984e3; border-bottom: 1px solid #F1F1F1;">

                <button type="button" id="confirmCreateContact" class="btn-confirm">Ajouter</button>
            </div>

            <div class="phone-messages" v-if="currentTab === 32">
                <div class="head">
                    <h1>Contacts</h1>
                    <i class="fa fa-plus"></i>
                </div>
                <ul class="contacts">
                    <li v-for="contact, i) in d.contacts" :class="[{ active: currentLi === i }]">
                        {{ contact.firstName}} <b>{{ contact.lastName }}</b>
                    </li>
                </ul>
            </div>

            <div class="phone-conversation" v-if="currentTab === 31">
                <div class="head">
                    <h1 style="width: 100%; text-align: center; text-indent: 0px; margin-left: -16px; margin-top: 18px; font-size: 15px;">
                        Nouveau message</h1>
                </div>
                <span class="sms-to">À :</span>
                <input type="text" v-model="newNumber">
                <div class="reply" id="reply-div">
                    <textarea id="reply" rows="3" v-model="newMessage"></textarea>
                    <button class="send" type="button" id="btnNewSms"><i class="fa fa-arrow-up"></i></button>
                </div>
            </div>

            <div class="phone-conversation" v-if="currentTab === 30">
                <div class="head">
                    <i class="fa fa-chevron-left"></i>
                    <h1>{{ talkName}}</h1>
                </div>
                <div id="chat" class="chat">
                    <div v-for="(msg, j) in d.messages" class="messages"
                        :class="{ 'mine' : msg.sender == phone, 'yours' : msg.sender != phone}">
                        <div class="message last" v-html="msg.text">
                            {{ msg.text | nl2br }}
                        </div>
                    </div>
                    <!-- <div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                                    <div class="message last">
                                        sdfsdfds
                                    </div>
                                </div><div class="messages mine">
                                        <div class="message last">
                                            sdfsdfds
                                        </div>
                                    </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                                <div class="message last">
                                    sdfsdfds
                                </div>
                            </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div><div class="messages mine">
                            <div class="message last">
                                sdfsdfds
                            </div>
                        </div> -->
                    <br><br><br><br><br>
                </div>
                <div class="reply" id="reply-div">
                    <textarea id="reply" rows="3" v-model="textMessage"></textarea>
                    <button class="send" type="button" id="btnSms"><i class="fa fa-arrow-up"></i></button>
                </div>
            </div>

            <div class="phone-calls animated zoomIn faster" v-if="currentTab === 2">

            </div>



            <div class="phone-footer" v-if="currentTab === 0">
                <a class="contact" :class="{ 'active' : homeFooterSelection == 1}"></a>
                <a class="call" :class="{ 'active' : homeFooterSelection == 2}"></a>
                <a class="sms" :class="{ 'active' : homeFooterSelection == 3}"></a>
                <a class="cog" :class="{ 'active' : homeFooterSelection == 4}"></a>
            </div>
        </div>
    </div>
</body>

</html>



<script>
    var sound;
    var interval;
    moment.locale("fr", { months: "janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"), monthsShort: "janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"), monthsParseExact: !0, weekdays: "dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"), weekdaysShort: "dim._lun._mar._mer._jeu._ven._sam.".split("_"), weekdaysMin: "Di_Lu_Ma_Me_Je_Ve_Sa".split("_"), weekdaysParseExact: !0, longDateFormat: { LT: "HH:mm", LTS: "HH:mm:ss", L: "DD/MM/YYYY", LL: "D MMMM YYYY", LLL: "D MMMM YYYY HH:mm", LLLL: "dddd D MMMM YYYY HH:mm" }, calendar: { sameDay: "[Aujourd’hui à] LT", nextDay: "[Demain à] LT", nextWeek: "dddd [à] LT", lastDay: "[Hier à] LT", lastWeek: "dddd [dernier à] LT", sameElse: "L" }, relativeTime: { future: "dans %s", past: "il y a %s", s: "quelques secondes", m: "une minute", mm: "%d minutes", h: "une heure", hh: "%d heures", d: "un jour", dd: "%d jours", M: "un mois", MM: "%d mois", y: "un an", yy: "%d ans" }, dayOfMonthOrdinalParse: /\d{1,2}(er|e)/, ordinal: function (e) { return e + (1 === e ? "er" : "e") }, meridiemParse: /PD|MD/, isPM: function (e) { return "M" === e.charAt(0) }, meridiem: function (e, a, r) { return e < 12 ? "PD" : "MD" }, week: { dow: 1, doy: 4 } });

    const app = new Vue({
        el: '#app',
        data: {
            homeFooterSelection: 1,
            currentTab: 0,
            currentLi: 0,
            phone: 0,       // MON NUMERO
            talkNumber: 0, // NUMERO DU DESTINATAIRE
            talkName: '',
            currentTalk: 0,
            newMessage: '',
            callNumber: '000000',
            newNumber: '000000',
            textMessage: '',
            contactId: 0,
            contactPhone: '',
            foundCall: 0,
            inCall: 0,
            endCall: 0,
            contactFirstName: '',
            contactLastName: '',
            callStatut: 'Appel en cours...',
            d: {
                messages: [

                ],
                talks: [

                ],
                contats: [

                ]
            },
        },
        created() {
            // this.updatePlayerMessages();
            // this.timer = setInterval(this.updatePlayerMessages, 3000);

            window.addEventListener('keydown', (e) => {
                if (e.key == 'Backspace') {
                    var reply = document.getElementById("reply");
                    var divcontactPhone = document.getElementById("contactPhone");
                    var divcontactFirstName = document.getElementById("contactFirstName");
                    var divcontactLastName = document.getElementById("contactLastName");

                    if(document.activeElement === reply || 
                    document.activeElement === divcontactPhone || 
                    document.activeElement === divcontactFirstName ||
                    document.activeElement === divcontactLastName)
                    {
                        return;
                    }

                    if (this.currentTab == 0) {
                        mp.trigger("cCloseCef");
                    }
                    if (this.currentTab == 3 || this.currentTab == 32 || this.currentTab == 40 || this.currentTab == 41 || this.currentTab == 42)
                        this.currentTab = 0;
                    if (this.currentTab == 30 || this.currentTab == 31)
                        this.currentTab = 3;
                    if (this.currentTab == 33 || this.currentTab == 34 || this.currentTab == 35)
                        this.currentTab = 32;
                    if(this.currentTab == 34 || this.currentTab == 35) 
                        mp.trigger("cShowCursor");

                    if(this.currentTab == 41 || this.currentTab == 42)
                    {
                        this.inCall = 0;
                        this.endCall = 1;
                        this.endCall();
                    }

                    mp.trigger("cHideCursor");

                }
                if (e.key == 'ArrowLeft') {

                    if (this.currentTab == 0) {
                        this.homeFooterSelection--;
                        if (this.homeFooterSelection < 1) this.homeFooterSelection = 4;
                    }
                }
                if (e.key == 'ArrowRight') {
                    if (this.currentTab == 0) {
                        this.homeFooterSelection++;
                        if (this.homeFooterSelection > 4) this.homeFooterSelection = 1;
                    }
                }
                if (e.key == 'ArrowDown') {
                    if (this.currentTab == 3) {
                        this.currentLi++;

                        if(this.currentLi >= (this.d.talks.length - 1))
                            this.currentLi = this.d.talks.length - 1;

                        for (let i = 0; i < this.d.talks.length; i++) {
                            if (this.currentLi == i) this.currentTalk = this.d.talks[i].id;
                        }
                    }
                    if (this.currentTab == 32) {
                        this.currentLi++;

                        if(this.currentLi >= (this.d.contacts.length - 1))
                            this.currentLi = this.d.contacts.length - 1;
                    }
                    if (this.currentTab == 30)
                        this.scrollToBottom("chat");
                    if (this.currentTab == 40) {
                        this.currentLi++;

                        if(this.currentLi >= (this.d.contacts.length - 1))
                            this.currentLi = this.d.contacts.length - 1;

                        for (let i = 0; i < this.d.contacts.length; i++) {
                            if (this.currentLi == i) {
                                this.callNumber = this.d.contacts[i].phone;
                            }
                        }
                    }

                }
                if (e.key == 'ArrowUp') {
                    if (this.currentTab == 3) {
                        this.currentLi--;
                        if (this.currentLi <= 0)
                            this.currentLi = 0;

                        for (let i = 0; i < this.d.talks.length; i++) {
                            if (this.currentLi == i) this.currentTalk = this.d.talks[i].id;
                        }
                    }
                    if (this.currentTab == 32) {
                        this.currentLi--;
                        if (this.currentLi <= 0)
                            this.currentLi = 0;
                    }
                    if (this.currentTab == 30)
                        this.scrollToTop("chat");
                    if (this.currentTab == 40) {
                        this.currentLi--;
                        if (this.currentLi <= 0)
                            this.currentLi = 0;

                        for (let i = 0; i < this.d.contacts.length; i++) {
                            if (this.currentLi == i) {
                                this.callNumber = this.d.contacts[i].phone;
                            }
                        }
                    }

                }
                if (e.key == 'Enter') {
                    // ENTRER DANS LES CONTACTS
                    if(this.homeFooterSelection == 1) {
                        this.homeFooterSelection = 0;
                        this.currentLi = 0;
                        return this.currentTab = 32;
                    }

                    // ENTRER DANS LES MESSAGES
                    if (this.homeFooterSelection == 3) {
                        this.currentLi = 0;

                        for (let i = 0; i < this.d.talks.length; i++) {
                            if(this.currentLi == i) this.currentTalk = this.d.talks[i].id;
                        }

                        this.homeFooterSelection = 0;

                        this.currentTab = 3;
                        return 1;
                    }

                    // ENTRER DANS LES APPELS
                    if(this.homeFooterSelection == 2) {
                        mp.trigger("cShowCursor");
                        this.homeFooterSelection = 0;
                        this.currentLi = 0;
                        return this.currentTab = 40;
                    }

                    // NOUVEL APPEL
                    if(this.currentTab == 40)
                    {
                        mp.trigger("cHideCursor");

                        this.currentTab = 41;
                        this.callStatut = 'Appel en cours...';

                        sound = new Howl({
                            src: ['sounds/tonalite.mp3']
                        });

                        sound.play();

                        var self = this;
                        setTimeout(function() {
                            self.checkCall();
                        }, 10000);

                        mp.trigger("cMisc-CallServerEvent", "sPhone-newCall", this.callNumber);
                    }

                    // REPONDRE A UN APPEL
                    if (this.currentTab == 42)
                    {
                        sound.stop();
                        clearInterval(interval);
                        this.currentTab = 41;

                        var self = this;
                        var timer = 0;
                        interval = setInterval(function() {
                            timer++;
                            self.updateCall(timer);
                        }, 1000);

                        this.inCall = 1;

                        mp.trigger("cMisc-CallServerEvent", "sPhone-respondCall", this.callNumber);
                    }

                    // ENTRER DANS UN CONTACT
                    if (this.currentTab == 32 && this.d.contacts.length >= 1) {
                        for (let i = 0; i < this.d.contacts.length; i++) {
                            if (this.currentLi == i) {
                                this.contactPhone = this.d.contacts[i].phone;
                                this.contactFirstName = this.d.contacts[i].firstName;
                                this.contactLastName = this.d.contacts[i].lastName;
                                this.contactId = this.d.contacts[i].id;
                            }
                        }
                        this.currentTab = 34;

                        mp.trigger("cShowCursor");

                        return 1;
                    }

                    // UPDATE UN CONTACT
                    if(this.currentTab == 34)
                    {
                        mp.trigger("cShowCursor");
                        if(document.activeElement.id == 'confirmUpdateContact') {
                            const data = {
                                id: this.contactId,
                                phone: this.contactPhone,
                                firstName: this.contactFirstName,
                                lastName: this.contactLastName,
                            }

                            mp.trigger("cMisc-CallServerEvent", "sPhone-updateContact", JSON.stringify(data));

                            mp.trigger("cHideCursor");
                        }
                    }

                    // NOUVEAU CONTACT
                    if(this.currentTab == 35)
                    {
                        mp.trigger("cShowCursor");
                        if(document.activeElement.id == 'confirmCreateContact') {
                            const data = {
                                phone: this.contactPhone,
                                firstName: this.contactFirstName,
                                lastName: this.contactLastName,
                            }

                            mp.trigger("cMisc-CallServerEvent", "sPhone-createContact", JSON.stringify(data));

                            this.currentTab = 32;
                        }
                    }


                    // ENTRER DANS UNE CONVERSATION
                    if(this.currentTab == 3 && this.d.talks.length >= 1) {
                        this.currentTab = 30;

                        if(this.currentLi > this.d.talks.length) return;

                        mp.trigger("cShowCursor");

                        for(let i = 0; i < this.d.talks.length; i++) {
                            if(i != this.currentLi) continue;

                            this.talkNumber = this.phone === this.d.talks[i].receiver ? this.d.talks[i].sender : this.d.talks[i].receiver;
                            this.talkName = this.talkNumber;

                            for(let j = 0; j < this.d.contacts.length; j++) {
                                if (this.talkNumber == this.d.contacts[j].phone) {
                                    this.talkName = this.d.contacts[j].firstName + ' ' + this.d.contacts[j].lastName;
                                }
                            }
                        }

                        setTimeout(function () {
                            var element = document.getElementById("chat");
                            element.scrollTop = element.scrollHeight;
                        }, 50);

                        return 1;
                    }
                    // NOUVELLE CONVERSATION
                    if (this.currentTab == 31) {
                        mp.trigger("cShowCursor");

                        if (document.activeElement.id == 'btnNewSms') {
                            const data = {
                                sender: this.phone,
                                receiver: this.newNumber,
                                text: this.newMessage,
                            }

                            if (data.sender == data.receiver) {
                                this.currentTab = 3;
                                this.currentLi = 0;

                                // mp.game.graphics.notify("~r~Vous ne pouvez pas vous envoyer de SMS.");
                                return 1;
                            }

                            this.talkNumber = data.receiver;

                            this.newNumber = '000000';
                            this.newMessage = '';

                            mp.trigger("cMisc-CallServerEvent", "sPhone-newMessage", JSON.stringify(data));

                            mp.trigger("cHideCursor");
                        }
                    }
                    if (this.currentTab == 30) {
                        if (document.activeElement.id == 'btnSms') {
                            const data = {
                                talk: this.currentTalk,
                                sender: this.phone,
                                receiver: this.talkNumber,
                                text: this.textMessage,
                                talkId: this.currentTalk
                            }

                            mp.trigger("cMisc-CallServerEvent", "sPhone-sendMessage", JSON.stringify(data));

                            mp.trigger("cHideCursor");

                            this.textMessage = '';
                        }
                    }
                }
                if(e.key == 'n') {
                    if(this.currentTab == 3) {
                        return this.currentTab = 31;
                    }
                    if(this.currentTab == 32) {
                        this.contactFirstName = 'Nouveau';
                        this.contactLastName = 'Contact';
                        this.contactPhone = '000000';
                        return this.currentTab = 35;
                    }
                }
            });
        },
        computed: {
            currentTabComponent: function () {
                return 'tab' + this.currentTab;
            },
        },
        methods: {
            hasRespondToCall: function() {
                clearInterval(interval);

                this.inCall = 1;

                sound.stop();

                var timer = 0;
                var self = this;
                interval = setInterval(function() {
                    timer++;
                    self.updateCall(timer);
                }, 1000);
            },
            receiveCall: function(sender) {
                this.homeFooterSelection = 0;
                this.currentTab = 42;
                this.callNumber = sender;
                this.callStatut = 'Appel entrant...';

                sound = new Howl({
                    src: ['sounds/sonnerie.mp3']
                });
                sound.play();

                var self = this;
                setTimeout(function() {
                    self.endCall();
                }, 10000);
            },
            updatePlayerMessages: function () {
                const data = {
                    talkId: this.currentTalk,
                }

                mp.trigger("cMisc-CallServerEvent", "sPhone-updatePlayerMessages", JSON.stringify(data));
            },
            endCall: function() {
                if(inCall == 0)
                {
                    this.currentTab = 0;
                    sound.stop();
                    clearInterval(interval);

                    mp.trigger("cMisc-CallServerEvent", "sPhone-endCall");
                }
            },
            updateCall: function(timer) {
                this.callStatut = 'Appel : ' + timer + ' secondes';
            },
            checkCall: function() {
                sound.stop();

                if(this.foundCall == 0 && this.inCall == 0)
                {
                    var self = this;
                    var timer = 0;
                    interval = setInterval(function() {
                        timer++;

                        if(timer >= 8)
                        {
                            clearInterval(interval);
                            this.currentTab = 0;
                            sound.stop();
                        }
                        self.updateCall(timer);
                    }, 1000);

                    sound = new Howl({
                        src: ['sounds/nondispo.mp3']
                    });
                    sound.play();
                }
            },
            scrollBottom: function (id) {
                var element = document.getElementById(id);
                console.log(element);
                element.scrollTop = element.scrollHeight;
            },
            scrollToBottom: function (id) {
                var element = document.getElementById(id);
                element.scrollTop += 20;
            },
            scrollToTop: function (id) {
                var element = document.getElementById(id);
                element.scrollTop -= 20;
            },
        },
        filters: {
            anonyme(str) {
                if(str.length <= 1 && str.charAt(0) == 'A') return '';
                else return str;
            },
            firstLetter(str) {
                if(typeof str === 'number') return 'N';
                return str.charAt(0);
            },
            secondLetter(str) {
                if(typeof str === 'number') return 'A';
                return str.charAt(0);
            },
            format(date) {
                var now = moment();

                if (moment(date).diff(now, 'days') <= 0)
                    return moment(date).format('LT');
                else if (moment(date).diff(now, 'days') <= 1)
                    return moment(date).format('Hier');
                else if (moment(date).diff(now, 'days') <= 7)
                    return moment(date).format('ddd');
                else if (moment(date).diff(now, 'days') >= 7)
                    return moment(date).format('D/MM/YYYY');
            },
            nl2br(str) {
                if (typeof str === 'undefined' || str === null) {
                    return '';
                }
                var breakTag = '<br>';
                return (str + '').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1' + breakTag + '$2');
            }
        },
    });
</script>