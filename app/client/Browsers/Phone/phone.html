<html>
    <meta charset="utf-8">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  	<script src="../vue.js"></script>
	<body>
		<div id="app">
            <div class="phone" style="background: url('images/wallpaper.png'); background-size: 100% 100%;">
                <img src="images/iphone-x.png">

                <div class="phone-messages animated zoomIn faster" v-if="currentTab === 1">
                    <div class="head">
                        <h1>Messages {{ phone }}</h1>
                        <i class="fa fa-comment"></i>
                    </div>  
                    <ul>
                        <li :class="[{ active: currentLi === 0 }]">
                            <div class="avatar">CM</div>
                            <h3>Lucky Salopio</h3>
                            <span class="time">12:10</span>
                            <i class="fa fa-chevron-right"></i>
                            <p>Wesh poto ça va ou quoi, tu veux pas baiser ta mère un peu .</p>
                        </li>
                        <li :class="[{ active: currentLi === 1 }]">
                            <div class="avatar">CM</div>
                            <h3>Lucky Salopio</h3>
                            <span class="time">12:10</span>
                            <i class="fa fa-chevron-right"></i>
                            <p>Wesh poto ça va ou quoi, tu veux pas baiser ta mère un peu .</p>
                        </li>
                    </ul>
                </div>

                <div class="phone-conversation" v-if="currentTab === 10">
                    <div class="head">
                        <i class="fa fa-chevron-left"></i>
                        <h1>Nitram Domenia {{ phone }}</h1>
                    </div>
                    <div id="chat" class="chat">
                        <!-- :class="[msg.sender === phone ? mine : yours]" -->
                        <div v-for="(msg, i) in d.messages" :class="[msg.sender == phone ? mine : '', messages]">
                            <div class="message last">
                                {{ msg.text }}
                            </div>
                        </div>
                        <br><br><br><br>
                    </div>
                    <div class="reply" id="reply-div">
                        <textarea id="reply" rows="3" @keyup="autoGrow">dfd</textarea>
                        <button class="send" type="button"><i class="fa fa-arrow-up"></i></button>
                    </div>
                </div>

                <div class="phone-calls animated zoomIn faster" v-if="currentTab === 2">
                    
                </div>

                
                
                <div class="phone-footer" v-if="currentTab === 0">
                    <a class="call" @click="currentTab = 2"></a>
                    <a class="sms" @click="currentTab = 1"></a>
                </div>
            </div>
		</div>
	</body>
</html>



<script>

const app = new Vue({
	el: '#app',
	data: {
        currentTab: 0,
        currentLi: 0,
        phone: 0,
		d: {
            messages: [
                
            ]
            // messages: [
            //     {"id":1,"sender":555555,"receiver":123456,"text":"wesh pd ça va ?","time":"2019-08-05T14:38:36.000Z"},{"id":2,"sender":555555,"receiver":123456,"text":"salope t'es ou ?","time":"2019-08-05T14:38:48.000Z"}
            // ],
		},
    },
    created() {
        window.addEventListener('keydown', (e) => {
            if(e.key == 'Backspace') {
                var reply = document.getElementById("reply");

                if(document.activeElement === reply)
                    return;

                if(this.currentTab == 0)
                    mp.trigger("cCloseCef"); 
                if(this.currentTab == 1)
                    this.currentTab = 0;
                if(this.currentTab == 10)
                    this.currentTab = 1;
            }
            if(e.key == 'ArrowDown') {
                if(this.currentTab == 1)
                {
                    this.currentLi++;
                }
                if(this.currentTab == 10)
                    this.scrollToBottom("chat");
                    
            }
            if(e.key == 'ArrowUp') {
                if(this.currentTab == 1)
                {
                    this.currentLi--;
                    if(this.currentLi <= 0)
                        this.currentLi = 0;
                }
                if(this.currentTab == 10)
                    this.scrollToTop("chat");
                    
            }
            if(e.key == 'Enter') {
                if(this.currentTab == 1)
                {
                    this.currentTab = 10;
                }
                if(this.currentTab == 10) 
                {
                    var element = document.getElementById("reply");
                    element.focus();
                }
            }
        });
    }, 
	computed: {
		currentTabComponent: function () {
			return 'tab' + this.currentTab;
		},
	},
	methods: {
        getMessages: function(str) {
            // this.d.messages = JSON.parse(str);
        },
        autoGrow: function() {
            var element = document.getElementById("reply");
            var element2 = document.getElementById("reply-div");
            if(element.clientHeight < element.scrollHeight)
            {
                element.style.height = element.scrollHeight + "px";
                if(element.clientHeight < element.scrollHeight)
                {
                    element.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 - element.clientHeight) + "px";
                }
                else 
                {
                    element.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                    element2.style.height = (element.scrollHeight * 2 + element.clientHeight) + "px";
                }
            }
        },
        scrollToBottom: function(id) {
            var element = document.getElementById(id);
            element.scrollTop += 20;
        },
        scrollToTop: function(id) {
            var element = document.getElementById(id);
            element.scrollTop -= 20;
        },
		exit: function() {
			mp.trigger("cCloseCef"); 
        },
	},
});
</script>